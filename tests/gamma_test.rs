use approx::assert_abs_diff_eq;
use puruspe::{
    ln_gamma,
    gamma
};

const LN_GAMMA_TABLE: [(f64, f64); 19] = [
    (1.00000000000000e-01, 2.25271265173421e+00),
    (2.00000000000000e-01, 1.52406382243078e+00),
    (5.00000000000000e-01, 5.72364942924700e-01),
    (1.00000000000000e+00, 0.00000000000000e+00),
    (1.50000000000000e+00, -1.20782237635245e-01),
    (2.00000000000000e+00, 0.00000000000000e+00),
    (2.50000000000000e+00, 2.84682870472919e-01),
    (3.00000000000000e+00, 6.93147180559945e-01),
    (4.00000000000000e+00, 1.79175946922805e+00),
    (5.00000000000000e+00, 3.17805383034795e+00),
    (1.00000000000000e+01, 1.28018274800815e+01),
    (2.00000000000000e+01, 3.93398841871995e+01),
    (5.00000000000000e+01, 1.44565743946345e+02),
    (2.50000000000000e-01, 1.28802252469808e+00),
    (7.50000000000000e-01, 2.03280951431295e-01),
    (1.00000000000000e-05, 1.15129196928958e+01),
    (1.00000000000000e-10, 2.30258509298827e+01),
    (1.00000000000000e+05, 1.05128770897366e+06),
    (1.00000000000000e+10, 2.20258509288811e+11),
];

#[test]
fn test_ln_gamma() {
    for (x, y) in LN_GAMMA_TABLE {
        let eps = 1e-10 + 1e-8 * ln_gamma(x).max(y).abs();
        if (ln_gamma(x) - y).abs() > eps {
            dbg!(x, ln_gamma(x), y);
        }
        assert_abs_diff_eq!(ln_gamma(x), y, epsilon = eps);
    }
}

const GAMMA_TABLE: [(f64, f64); 21] = [
    (-1.50000000000000e+00, 2.36327180120735e+00),
    (-5.00000000000000e-01, -3.54490770181103e+00),
    (1.00000000000000e-01, 9.51350769866873e+00),
    (2.00000000000000e-01, 4.59084371199880e+00),
    (5.00000000000000e-01, 1.77245385090552e+00),
    (1.00000000000000e+00, 1.00000000000000e+00),
    (1.50000000000000e+00, 8.86226925452758e-01),
    (2.00000000000000e+00, 1.00000000000000e+00),
    (2.50000000000000e+00, 1.32934038817914e+00),
    (3.00000000000000e+00, 2.00000000000000e+00),
    (4.00000000000000e+00, 6.00000000000000e+00),
    (5.00000000000000e+00, 2.40000000000000e+01),
    (1.00000000000000e+01, 3.62880000000000e+05),
    (2.00000000000000e+01, 1.21645100408832e+17),
    (5.00000000000000e+01, 6.08281864034268e+62),
    (2.50000000000000e-01, 3.62560990822191e+00),
    (7.50000000000000e-01, 1.22541670246518e+00),
    (1.00000000000000e-05, 9.99994227942255e+04),
    (1.00000000000000e-10, 9.99999999942278e+09),
    (1.00000000000000e+02, 9.33262154439442e+155),
    (1.70000000000000e+02, 4.26906800900471e+304),
];

#[test]
fn test_gamma() {
    for (x, y) in GAMMA_TABLE {
        let eps = f64::EPSILON + 1e-10 * gamma(x).max(y).abs();
        if (gamma(x) - y).abs() > eps {
            dbg!(x, gamma(x), y);
        }
        assert_abs_diff_eq!(gamma(x), y, epsilon = eps);
    }
}
